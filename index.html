<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Week 2: Javascript and the DOM</title><!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <style>
    .section { padding: 1em 0; }

    .btn-toolbar {
      padding: 1em 0;
    }
    /* An "em" is equal to the height of a line of text. */
    .header {
      background: linear-gradient(to bottom, #337ab7 0%, #135a97 100%);
      color: white;
      padding: 1em 0 2em;
    } 
    #data-table td {
      width: 14.2%;
      /* The table has four columns, so this rule makes them of equal width. */
    }
    .bar {
      height: 20px;
      /* Note that we'll set the width dynamically using Javascript. */
      background: #337ab7;
    }
  </style>
</head>
<body>
<div class="header section">
  <div class="container">
    <h1>Week 2: Javascript and the DOM</h1>
    <p>Let's wire up some buttons.</p>
  </div>
</div>
<div class="controls section">
  <div class="container">
    <div class="btn-toolbar">
      <div class="btn-group" data-toggle="buttons">
        
        <!-- I'm not sure why the radio butons aren't staying in their visual checked state. It works functionally but not visually.-->
        <label class="btn btn-default">
          <input type="radio" name="options" id="sort-clinton" autocomplete="off">Clinton
        </label>
        <label class="btn btn-default">
          <input type="radio" name="options" id="sort-sanders" autocomplete="off">Sanders
        </label>
      </div>

      <div class="btn-group">
        <button type="button" class="btn btn-default" id="sort-asc">Ascending</button>
        <button type="button" class="btn btn-default" id="sort-desc">Descending</button>
      </div>
    </div>

    <div class="btn-toolbar">
      <div class="btn-group">
        <button type="button" class="btn btn-default" id="filter-primary">Primary</button>
        <button type="button" class="btn btn-default" id="filter-caucus">Caucus</button>
      </div>
    </div>
  </div>
</div>
<div class="main section">
  <div class="container">
    <table class="table" id="data-table">
      <thead>
        <tr>
          <th>State</th>
          <th>Date</th>
          <th>Clinton</th>
          <th>Sanders</th>
          <th>Election Type</th>
          <th>Open/Closed</th>
          <th>State's Percent of Total Delegates</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
    <nav>
      <ul class="pager">
        <li class="previous"><a href="#" id="page-prev">Previous</a></li>
        <li class="next"><a href="#" id="page-next">Next</a></li>
      </ul>
    </nav>
  </div>
</div>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
<script>
  var dem_delegates = [{"State":"District of Columbia","Date":"June 14","Clinton":16,"Sanders":4,"Election_Type":"Primary","Open_Closed":"Closed"},
{"State":"California","Date":"June 07","Clinton":269,"Sanders":206,"Election_Type":"Primary","Open_Closed":"Semi-closed"},
{"State":"Montana","Date":"June 07","Clinton":10,"Sanders":11,"Election_Type":"Primary","Open_Closed":"Open"},
{"State":"New Jersey","Date":"June 07","Clinton":79,"Sanders":47,"Election_Type":"Primary","Open_Closed":"Closed"},
{"State":"North Dakota","Date":"June 07","Clinton":5,"Sanders":13,"Election_Type":"Primary","Open_Closed":"Open"},
{"State":"New Mexico","Date":"June 07","Clinton":18,"Sanders":16,"Election_Type":"Primary","Open_Closed":"Closed"},
{"State":"South Dakota","Date":"June 07","Clinton":10,"Sanders":10,"Election_Type":"Primary","Open_Closed":"Semi-open"},
{"State":"Puerto Rico","Date":"June 05","Clinton":36,"Sanders":24,"Election_Type":"Primary","Open_Closed":"Open"},
{"State":"Virgin Islands","Date":"June 04","Clinton":7,"Sanders":0,"Election_Type":"Caucus","Open_Closed":"Closed"},
{"State":"Oregon","Date":"May 17","Clinton":25,"Sanders":36,"Election_Type":"Primary","Open_Closed":"Closed"},
{"State":"Kentucky","Date":"May 17","Clinton":28,"Sanders":27,"Election_Type":"Primary","Open_Closed":"Closed"},
{"State":"West Virginia","Date":"May 10","Clinton":11,"Sanders":18,"Election_Type":"Primary","Open_Closed":"Semi-closed"},
{"State":"Guam","Date":"May 07","Clinton":4,"Sanders":3,"Election_Type":"Caucus","Open_Closed":"Closed"},
{"State":"Indiana","Date":"May 03","Clinton":39,"Sanders":44,"Election_Type":"Primary","Open_Closed":"Open"},
{"State":"Rhode Island","Date":"April 26","Clinton":11,"Sanders":13,"Election_Type":"Primary","Open_Closed":"Semi-closed"},
{"State":"Pennsylvania","Date":"April 26","Clinton":106,"Sanders":83,"Election_Type":"Primary","Open_Closed":"Closed"},
{"State":"Delaware","Date":"April 26","Clinton":12,"Sanders":9,"Election_Type":"Primary","Open_Closed":"Closed"},
{"State":"Connecticut","Date":"April 26","Clinton":28,"Sanders":27,"Election_Type":"Primary","Open_Closed":"Closed"},
{"State":"Maryland","Date":"April 26","Clinton":60,"Sanders":35,"Election_Type":"Primary","Open_Closed":"Closed"},
{"State":"New York","Date":"April 19","Clinton":139,"Sanders":108,"Election_Type":"Primary","Open_Closed":"Closed"},
{"State":"Wyoming","Date":"April 09","Clinton":7,"Sanders":7,"Election_Type":"Caucus","Open_Closed":"Closed"},
{"State":"Wisconsin","Date":"April 05","Clinton":38,"Sanders":48,"Election_Type":"Primary","Open_Closed":"Open"},
{"State":"Washington","Date":"March 26","Clinton":27,"Sanders":74,"Election_Type":"Caucus","Open_Closed":"Open"},
{"State":"Hawaii","Date":"March 26","Clinton":8,"Sanders":17,"Election_Type":"Caucus","Open_Closed":"Semi-closed"},
{"State":"Alaska","Date":"March 26","Clinton":3,"Sanders":13,"Election_Type":"Caucus","Open_Closed":"Closed"},
{"State":"Utah","Date":"March 22","Clinton":6,"Sanders":27,"Election_Type":"Caucus","Open_Closed":"Semi-open"},
{"State":"Idaho","Date":"March 22","Clinton":5,"Sanders":18,"Election_Type":"Caucus","Open_Closed":"Open"},
{"State":"Arizona","Date":"March 22","Clinton":42,"Sanders":33,"Election_Type":"Primary","Open_Closed":"Closed"},
{"State":"Ohio","Date":"March 15","Clinton":81,"Sanders":62,"Election_Type":"Primary","Open_Closed":"Semi-open"},
{"State":"North Carolina","Date":"March 15","Clinton":60,"Sanders":47,"Election_Type":"Primary","Open_Closed":"Semi-closed"},
{"State":"Missouri","Date":"March 15","Clinton":36,"Sanders":35,"Election_Type":"Primary","Open_Closed":"Open"},
{"State":"Illinois","Date":"March 15","Clinton":79,"Sanders":77,"Election_Type":"Primary","Open_Closed":"Open"},
{"State":"Florida","Date":"March 15","Clinton":141,"Sanders":73,"Election_Type":"Primary","Open_Closed":"Closed"},
{"State":"Northern Marianas","Date":"March 12","Clinton":4,"Sanders":2,"Election_Type":"N/A","Open_Closed":"N/A"},
{"State":"Michigan","Date":"March 08","Clinton":63,"Sanders":67,"Election_Type":"Primary","Open_Closed":"Open"},
{"State":"Mississippi","Date":"March 08","Clinton":31,"Sanders":5,"Election_Type":"Primary","Open_Closed":"Open"},
{"State":"Maine","Date":"March 06","Clinton":8,"Sanders":17,"Election_Type":"Caucus","Open_Closed":"Closed"},
{"State":"Kansas","Date":"March 05","Clinton":10,"Sanders":23,"Election_Type":"Caucus","Open_Closed":"Closed"},
{"State":"Nebraska","Date":"March 05","Clinton":10,"Sanders":15,"Election_Type":"Caucus","Open_Closed":"Closed"},
{"State":"Louisiana","Date":"March 05","Clinton":37,"Sanders":14,"Election_Type":"Primary","Open_Closed":"Closed"},
{"State":"Virginia","Date":"March 01","Clinton":62,"Sanders":33,"Election_Type":"Primary","Open_Closed":"Open"},
{"State":"Vermont","Date":"March 01","Clinton":0,"Sanders":16,"Election_Type":"Primary","Open_Closed":"Open"},
{"State":"Texas","Date":"March 01","Clinton":147,"Sanders":75,"Election_Type":"Primary","Open_Closed":"Open"},
{"State":"Tennessee","Date":"March 01","Clinton":44,"Sanders":23,"Election_Type":"Primary","Open_Closed":"Open"},
{"State":"Oklahoma","Date":"March 01","Clinton":17,"Sanders":21,"Election_Type":"Primary","Open_Closed":"Semi-closed"},
{"State":"Minnesota","Date":"March 01","Clinton":31,"Sanders":46,"Election_Type":"Caucus","Open_Closed":"Open"},
{"State":"Massachusetts","Date":"March 01","Clinton":46,"Sanders":45,"Election_Type":"Primary","Open_Closed":"Semi-closed"},
{"State":"Georgia","Date":"March 01","Clinton":73,"Sanders":29,"Election_Type":"Primary","Open_Closed":"Open"},
{"State":"Democrats Abroad","Date":"March 1-8","Clinton":4,"Sanders":9,"Election_Type":"Primary","Open_Closed":"Closed"},
{"State":"Colorado","Date":"March 01","Clinton":25,"Sanders":41,"Election_Type":"Caucus","Open_Closed":"Closed"},
{"State":"Arkansas","Date":"March 01","Clinton":22,"Sanders":10,"Election_Type":"Primary","Open_Closed":"Open"},
{"State":"American Samoa","Date":"March 01","Clinton":4,"Sanders":2,"Election_Type":"Caucus","Open_Closed":"Closed"},
{"State":"Alabama","Date":"March 01","Clinton":44,"Sanders":9,"Election_Type":"Primary","Open_Closed":"Open"},
{"State":"South Carolina","Date":"February 27","Clinton":39,"Sanders":14,"Election_Type":"Primary","Open_Closed":"Open"},
{"State":"Nevada","Date":"February 20","Clinton":20,"Sanders":15,"Election_Type":"Caucus","Open_Closed":"Closed"},
{"State":"New Hampshire","Date":"February 09","Clinton":9,"Sanders":15,"Election_Type":"Primary","Open_Closed":"Semi-closed"},
{"State":"Iowa","Date":"February 01","Clinton":23,"Sanders":21,"Election_Type":"Caucus","Open_Closed":"Semi-open"}];

  // The ALL_CAPS treatment here is signalling that this variable is a constant - it should never change.
  var TOTAL_DELEGATES = 4051;

  // This is where we'll store the data representing user interaction; event handlers (the functions that
  // are called when a user clicks a button) work by updating the properties of this object. An alternative
  // approach, where each event handler directly updates the table, would quickly become messy. Imagine,
  // for example, that I've filtered the table to just show elementary schools. Next, I sort the table to
  // be in descending order. Finally, I unfilter the table to show all schools. If I'm not careful, the
  // newly revealed schools will not be sorted, because the filter operation doesn't know how to sort.
  // Instead, updateTable() will sort, filter, and paginate based on whatever the options object contains,
  // always starting from a fresh copy of the data, and we can count on the result to be consistent
  // given the same values in options.
  var options = {
    candidate: false,
    sorted: false,
    filtered: false,
    page: 0
  };

  function updateTable() {
    // Make a copy of the data
    var data = dem_delegates.slice();

    // Sort election by delegate count and candidate
    // Is there a way to structure the code such that I don't need to add the "&& options.candidate === 'clinton'"?
    // In something like SAS or R we could write the return statement like {return a.[options.candidate] - b.[options.candidate]}
    // in order to filter on what we've already set as the filter criteria somewhere else.
    if (options.sorted && options.candidate) {

      // Ascending sort
      if (options.sorted === 'asc' && options.candidate === 'clinton') {
        data.sort(function (a, b) { return a.Clinton - b.Clinton; });
      }  
       else if (options.sorted === 'asc' && options.candidate === 'sanders') {
        data.sort(function (a, b) { return a.Sanders - b.Sanders; });
      }

      // Descending sort
       else if (options.sorted === 'desc' && options.candidate === 'clinton') {
        data.sort(function (a, b) { return b.Clinton - a.Clinton; });
      }
       else if (options.sorted === 'desc' && options.candidate === 'sanders') {
        data.sort(function (a, b) { return b.Sanders - a.Sanders; });
      }
    } 

    // Filter by election type

    if (options.filtered) {

      if (options.filtered === 'primary') {
        data = data.filter(function (d) {return d.Election_Type === 'Primary'});
      }
      else if (options.filtered === 'caucus') {
        data = data.filter(function (d) {return d.Election_Type === 'Caucus'});
      }
    }

    // Select only the schools from the current page (slice)

    var table = document.getElementById('data-table');
    var tbody = table.getElementsByTagName('tbody')[0];
    // Because getElementsByTagName returns an array of DOM nodes (technically, it's an HTMLCollection),
    // we need to select the first item in the array with the [0].

    // Remove any existing rows
    tbody.innerHTML = '';

    // Add a new row for each datum (item in the 'data' array)
    data.forEach(function (d) {
      var row = document.createElement('tr');
      // This is like create a new <tr></tr> in HTML, but it doesn't yet exist in the DOM, so we can't
      // see it. At the bottom of this forEach() loop, we append it to an element that is in the DOM,
      // at which point it appears. We'll follow this same pattern for each of the <td></td> elements
      // we create below.

      var state = document.createElement('td');
      state.innerHTML = d.State;
      row.appendChild(state);

      var date = document.createElement('td');
      date.innerHTML = d.Date;
      row.appendChild(date);

      var clinton = document.createElement('td');
      clinton.innerHTML = d.Clinton;
      row.appendChild(clinton);

      var sanders = document.createElement('td');
      sanders.innerHTML = d.Sanders;
      row.appendChild(sanders);

      var elec_type = document.createElement('td');
      elec_type.innerHTML = d.Election_Type;
      row.appendChild(elec_type);

      var openclose = document.createElement('td');
      openclose.innerHTML = d.Open_Closed;
      row.appendChild(openclose);

      var barWrapper = document.createElement('td');
      var bar = document.createElement('div');
      bar.setAttribute('class', 'bar');
      // We set the class to 'bar' so we can use the .bar class we have in our styles. This gives it a
      // consistent height and a color.
      var delegatePercentage = (d.Clinton + d.Sanders) / TOTAL_DELEGATES;
      bar.setAttribute('style', 'width: ' + (delegatePercentage * 100) + '%;');
      // I've broken this operation up into two steps, which is a little different than we did in class.
      // The end result is the same, though. If 'enrollmentPercentage' equals 0.75, this set the style
      // attribute of our DIV so that it looks something like <div style="width: 75%;"></div>
      barWrapper.appendChild(bar);
      row.appendChild(barWrapper);

      tbody.appendChild(row);
    });
  }

  // The function declaration above just creates the function, it doesn't yet run it. That's what we
  // do here, to make sure that the table is populated prior to the user clicking anything.
  updateTable();

  // This is creating an event listener, a function that the browser will call every time the specified
  // event is "fired" by the selected element (here the button with the id 'sort-asc').

  // Sort Category Event Listeners
  document.getElementById('sort-clinton').addEventListener('click', function () {
    if (options.candidate === 'clinton') {
      options.candidate = false;
    } else {
      options.candidate = 'clinton';
      options.sorted = false;
    }
    updateTable();
  });

  document.getElementById('sort-sanders').addEventListener('click', function () {
    if (options.candidate === 'sanders') {
      options.candidate = false;
    } else {
      options.candidate = 'sanders';
      options.sorted = false;
    }
    updateTable();
  });

// Sort direction listeners
  document.getElementById('sort-asc').addEventListener('click', function () {
    if (options.sorted === 'asc') {
      options.sorted = false;
    } else {
      options.sorted = 'asc';
    }

    updateTable();
  });

  document.getElementById('sort-desc').addEventListener('click', function () {
    if (options.sorted === 'desc') {
      options.sorted = false;
    } else {
      options.sorted = 'desc';
    }

    updateTable();
  });

  // This is where we'll need to create new event listeners for our filter and next/previous page buttons.
  // They'll look very similar to the above, just listening to different elements, and perhaps performing
  // different actions when clicked.

  document.getElementById('filter-primary').addEventListener('click', function () {
    if (options.filtered === 'primary') {
      options.filtered = false;
    } else {
      options.filtered = 'primary'
    }

    updateTable();
  });

  document.getElementById('filter-caucus').addEventListener('click', function () {
    if (options.filtered === 'caucus') {
      options.filtered = false;
    } else {
      options.filtered = 'caucus'
    }

    updateTable();
  });

</script>
</body>
</html>
